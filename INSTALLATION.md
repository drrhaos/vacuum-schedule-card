# Инструкция по установке

## Быстрая установка

### Шаг 1: Установка карточки

#### Вариант A: Через HACS (рекомендуется)

1. Убедитесь, что HACS установлен
2. Добавьте репозиторий в HACS:
   - Frontend → три точки → Custom repositories
   - URL: `https://github.com/drrhaos/vacuum-schedule-card`
   - Type: `Lovelace`
3. Установите карточку через HACS
4. Перезагрузите Home Assistant

#### Вариант B: Ручная установка

1. Скачайте `vacuum-schedule-card.js`
2. Поместите в папку `www/` вашего Home Assistant
3. Добавьте ресурс в Lovelace:
   - Настройки → Панели управления → Lovelace → Ресурсы
   - Добавить ресурс → `/local/vacuum-schedule-card.js` → JavaScript Module
4. Перезагрузите Home Assistant

### Шаг 2: Создание input_text helper

Для сохранения расписаний необходимо создать helper:

1. Настройки → Устройства и службы → Помощники
2. Создать помощник → Текст
3. Настройки:
   - Имя: `Расписания уборки [название пылесоса]`
   - ID: `vacuum_schedules_[entity_id без vacuum.]`
     - Например, для `vacuum.xiaomi_m30s` → `vacuum_schedules_xiaomi_m30s`
   - Начальное значение: `[]`
   - Максимальная длина: `10000`
4. Сохраните

Или добавьте в `configuration.yaml`:

```yaml
input_text:
  vacuum_schedules_xiaomi_m30s:
    name: "Расписания уборки M30S"
    initial: "[]"
    max: 10000
```

### Шаг 3: Добавление карточки на панель

1. Редактировать панель → Добавить карточку
2. Ручная конфигурация
3. Добавьте:

```yaml
type: custom:vacuum-schedule-card
entity: vacuum.xiaomi_m30s
```

Замените `vacuum.xiaomi_m30s` на entity_id вашего пылесоса.

## Получение ID комнат

Для правильной работы необходимо знать ID комнат вашего пылесоса:

1. Developer Tools → Services
2. Сервис: `dreame_vacuum.get_room_mapping`
3. Entity: выберите ваш пылесос
4. Вызовите сервис
5. Проверьте результат в логах или уведомлениях

## Создание автоматизаций

Карточка попытается создать автоматизации автоматически. Если это не удастся, вы получите уведомление с инструкциями.

Для ручного создания автоматизаций используйте следующие параметры:

- **Триггер**: Время (например, 09:00)
- **Условие**: День недели (выбранные дни)
- **Действие**: `dreame_vacuum.vacuum_clean_segment`
  - Entity: ваш пылесос
  - Segments: ID комнат (массив чисел)

## Устранение неполадок

### Карточка не отображается

- Проверьте, что ресурс добавлен в Lovelace
- Перезагрузите Home Assistant
- Проверьте консоль браузера на ошибки (F12)

### Расписания не сохраняются

- Убедитесь, что создан input_text helper с правильным ID
- Проверьте логи Home Assistant

### Автоматизации не создаются

- Это нормально - карточка покажет уведомление с инструкциями
- Создайте автоматизации вручную в разделе "Автоматизации"
- Используйте параметры из уведомления

### Комнаты не отображаются

- Проверьте, что интеграция dreame-vacuum установлена
- Убедитесь, что пылесос подключен и работает
- Используйте сервис `get_room_mapping` для получения списка комнат

