# Vacuum Schedule Card

Кастомная карточка для Home Assistant, позволяющая создавать и управлять расписанием уборки для роботов-пылесосов (включая Dreame, Xiaomi M30S и другие) с использованием интеграции [dreame-vacuum](https://github.com/Tasshack/dreame-vacuum).

## Возможности

- ✅ Создание расписаний уборки
- ✅ Выбор дней недели
- ✅ Установка времени уборки
- ✅ Выбор комнат для уборки
- ✅ Включение/выключение расписаний
- ✅ Редактирование и удаление расписаний
- ✅ Автоматическое создание автоматизаций в Home Assistant
- ✅ Поддержка локализации (русский и английский языки)

## Установка

### Через HACS (рекомендуется)

1. Убедитесь, что у вас установлен [HACS](https://hacs.xyz/)
2. В HACS перейдите в раздел "Frontend"
3. Нажмите на три точки в правом верхнем углу → "Настройки" → "Пользовательские репозитории"
4. Добавьте репозиторий:
   - URL: `https://github.com/drrhaos/vacuum-schedule-card`
   - Категория: "Lovelace"
5. Найдите "Vacuum Schedule Card" в HACS и установите
6. Перезагрузите Home Assistant

### Ручная установка

1. Скачайте файл `vacuum-schedule-card.js` из релизов
2. Скопируйте его в папку `www` в конфигурационном каталоге Home Assistant
3. Добавьте ресурс в Home Assistant:
   - Перейдите в "Настройки" → "Панели управления" → "Lovelace" → "Ресурсы"
   - Нажмите "Добавить ресурс"
   - URL: `/local/vacuum-schedule-card.js`
   - Тип: "JavaScript Module"
4. Перезагрузите Home Assistant

## Использование

### Добавление карточки на панель

1. Перейдите в режим редактирования панели Lovelace
2. Нажмите "Добавить карточку"
3. Выберите "Ручная конфигурация"
4. Добавьте следующую конфигурацию:

```yaml
type: custom:vacuum-schedule-card
entity: vacuum.your_vacuum_entity
```

Замените `vacuum.your_vacuum_entity` на идентификатор вашего пылесоса (например, `vacuum.xiaomi_m30s`).

### Создание расписания

1. Нажмите кнопку "Добавить" на карточке
2. Выберите дни недели (можно выбрать несколько)
3. Установите время уборки
4. Выберите комнаты для уборки (можно выбрать несколько)
5. Включите или выключите расписание
6. Нажмите "Сохранить"

### Управление расписаниями

- **Включение/выключение**: Используйте переключатель справа от расписания
- **Удаление**: Нажмите кнопку с иконкой корзины
- **Редактирование**: Нажмите на расписание для редактирования

## Настройка комнат

По умолчанию карточка использует список комнат из атрибутов вашего пылесоса. Если комнаты не определены, будут использованы стандартные названия:
- Гостиная
- Спальня
- Кухня
- Ванная

Для получения правильных ID комнат вашего пылесоса:

1. Откройте Developer Tools в Home Assistant
2. Перейдите на вкладку "Services"
3. Выберите сервис `dreame_vacuum.get_room_mapping`
4. Укажите `entity_id` вашего пылесоса
5. Вызовите сервис
6. Проверьте результат в логах или уведомлениях

## Автоматизации

Карточка автоматически создает автоматизации в Home Assistant для каждого расписания. Автоматизации создаются с именами вида:
- `automation.vacuum_schedule_{schedule_id}_day_{day}`

Где:
- `schedule_id` - уникальный идентификатор расписания
- `day` - номер дня недели (0-6)

Автоматизации используют сервис `dreame_vacuum.vacuum_clean_segment` для запуска уборки выбранных комнат.

## Локализация

Карточка автоматически определяет язык интерфейса Home Assistant и отображает текст на соответствующем языке. Поддерживаются следующие языки:

- **Русский** (ru) - автоматически определяется для языков, начинающихся с "ru"
- **Английский** (en) - используется по умолчанию для всех остальных языков

Язык определяется из настроек Home Assistant (`hass.locale.language` или `hass.language`). Если язык не определен или не поддерживается, используется английский.

## Требования

- Home Assistant 2023.1 или новее
- Интеграция [dreame-vacuum](https://github.com/Tasshack/dreame-vacuum) от Tasshack
- Робот-пылесос Dreame (Xiaomi M30S и другие модели)

## Разработка

### Сборка из исходников

1. Установите зависимости:
```bash
npm install
```

2. Соберите проект:
```bash
npm run build
```

3. Для разработки с автоматической пересборкой:
```bash
npm run watch
```

### Структура проекта

```
.
├── src/
│   └── vacuum-schedule-card.ts  # Исходный код карточки
├── vacuum-schedule-card.js      # Скомпилированный файл
├── package.json                        # Зависимости проекта
├── tsconfig.json                       # Конфигурация TypeScript
├── webpack.config.js                   # Конфигурация сборки
└── README.md                           # Документация
```

## Поддержка

Если у вас возникли проблемы или вопросы:

1. Проверьте логи Home Assistant на наличие ошибок
2. Убедитесь, что интеграция dreame-vacuum установлена и работает
3. Проверьте, что entity_id пылесоса указан правильно
4. Создайте issue в репозитории проекта

## Лицензия

MIT

## Благодарности

- [Tasshack](https://github.com/Tasshack) за интеграцию dreame-vacuum
- Сообщество Home Assistant за поддержку
